# Template file for 'devkitpro-pacman'
pkgname=devkitpro-pacman
version=5.1.3
revision=3
wrksrc="pacman-${version}"
make_dirs="/opt/devkitpro/pacman/var/lib/pacman 0755 root root
 /opt/devkitpro/pacman/var/cache/pacman/pkg 0755 root root
 /opt/devkitpro/pacman/share/makepkg-template 0755 root root
 /opt/devkitpro/pacman/share/libalpm/hooks 0755 root root
 /usr/share/pacman/keyrings 0755 root root"
configure_args="--disable-doc --disable-shared --prefix=/opt/devkitpro/pacman
 --with-crypto=nettle --with-pkg-ext=.pkg.tar.xz --with-src-ext=.src.tar.xz
 --with-makepkg-template-dir=/opt/devkitpro/pacman/share/makepkg-template"
build_style=configure
hostmakedepends="autoconf automake libtool gettext-devel pkg-config"
makedepends="libarchive-devel nettle-devel gpgme-devel libcurl-devel"
depends="gnupg"
short_desc="Nintendo Homebrew package manager"
maintainer="oreo639 <oreo6391@gmail.com>"
license="GPL-3.0-or-later"
homepage="https://www.devkitpro.org/"
distfiles="https://sources.archlinux.org/other/pacman/pacman-${version}.tar.gz"
checksum=10db61a0928d619871340c3f93a677d1541d6c52353c516aec4f8d96e830d4eb

pre_configure() {
	case "$XBPS_TARGET_MACHINE" in
		x86_64)
			patch -Np0 -i ${FILESDIR}/repo-glibc.patch
			;;
		*musl)
			patch -Np0 -i ${FILESDIR}/repo-musl.patch
			;;
	esac
}

post_install() {
	ln -s /usr/share/pacman/keyrings "$DESTDIR/opt/devkitpro/pacman/share/pacman"
	vmkdir usr
	vmkdir usr/bin
	for f in dkp-makepkg dkp-pacman dkp-pacman-key dkp-repo-add dkp-repo-remove; do
		vbin "$FILESDIR/$f"
	done
}
